<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Smart Ramallah Waste Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      height: 100%;
      width: 100%;
      background: #111;
    }

    #map {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
    #infoBox {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(30, 30, 30, 0.8);
      color: #fff;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      z-index: 1000;
      font-family: Arial, sans-serif;
    }

    /* Ø²Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ */
    .analyze-btn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: #ffa500;
      color: #111;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      z-index: 1000;
      transition: 0.3s;
    }

    .analyze-btn:hover {
      background: #ffcc33;
    }

    /* Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ù…Ø§Ù„ */
    .leaflet-control-north {
      position: absolute;
      top: 10px;
      left: 10px;
      background: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/North_arrow.svg') no-repeat center;
      background-size: 40px 40px;
      width: 40px;
      height: 40px;
      z-index: 1000;
    }
  </style>

</head>

<body>
  <div id="map"></div>
  <div id="infoBox">Ù…Ø±Ø± Ø§Ù„Ù…Ø¤Ø´Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø©</div>
  <button class="analyze-btn" id="analyzeBtn">ØªØ­Ù„ÙŠÙ„ Ø³Ø±ÙŠØ¹ ğŸ§ </button>

  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>
    const map = L.map("map", {
      center: [31.9045, 35.2045],
      zoom: 17.5,
      zoomSnap: 0.5,
    });

    // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø³Ø§Ø³
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap & CARTO',
      subdomains: 'abcd',
      maxZoom: 20
    }).addTo(map);

    let wasteContainers = [];
    let zonesLayer;

    // ØªØ­Ù…ÙŠÙ„ Ø·Ø¨Ù‚Ø© Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
    $.getJSON("wasteContainer.json", function (WC) {
      wasteContainers = L.geoJson(WC, {
        pointToLayer: function (feature, latlng) {
          return L.circleMarker(latlng, {
            radius: 5,
            fillColor: "orange",
            color: "orange",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });
        }
      }).addTo(map);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ù…Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    $.getJSON("RamallahZones.json", function (RZ) {
      zonesLayer = L.geoJson(RZ, {
        style: function (feature) {
          return {
            fillColor: "yellow",
            fillOpacity: 0.3,
            color: "yellow",
            weight: 1.0,
            opacity: 0.7
          };
        },
        onEachFeature: function (feature, layer) {
          // Popup ÙÙŠÙ‡ ÙÙŠØ¯ÙŠÙˆ + Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ
          layer.bindPopup(`
            <h4>${feature.properties.NAME_ENGLI}</h4>
            <video width="230" controls>
              <source src="videos/ramallah_info.mp4" type="video/mp4">
            </video>
            <canvas id="chart-${feature.properties.MAIL_CODE}" width="200" height="150"></canvas>
          `);

          layer.on('popupopen', function () {
            const ctx = document.getElementById(`chart-${feature.properties.MAIL_CODE}`).getContext('2d');
            new Chart(ctx, {
              type: 'bar',
              data: {
                labels: ['Organic', 'Plastic', 'Metal'],
                datasets: [{
                  label: 'Tons',
                  data: [12, 7, 3],
                  backgroundColor: ['#66bb6a', '#ffa726', '#42a5f5']
                }]
              },
              options: { plugins: { legend: { display: false } } }
            });
          });

          // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø¯ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø§ÙˆØ³
          layer.on('mouseover', function () {
            document.getElementById('infoBox').innerHTML = `Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: <b>${feature.properties.NAME_ENGLI}</b>`;
          });
          layer.on('mouseout', function () {
            document.getElementById('infoBox').innerHTML = 'Ù…Ø±Ø± Ø§Ù„Ù…Ø¤Ø´Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø©';
          });
        }
      }).addTo(map);
    });

    // Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø±Ø³Ù…
    L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map);

    // Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ù…Ø§Ù„
    L.Control.North = L.Control.extend({
      onAdd: function () {
        const img = L.DomUtil.create('div', 'leaflet-control-north');
        return img;
      }
    });
    L.control.north = function (opts) {
      return new L.Control.North(opts);
    }
    L.control.north({ position: 'topleft' }).addTo(map);

    // Ø¹Ù†Ø¯ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø´Ø¯ÙŠØ¯ ØªØ¸Ù‡Ø± ØµÙˆØ±Ø© ÙˆØ§Ù‚Ø¹ÙŠØ©
    const bounds = [[31.9035, 35.2035], [31.9055, 35.2055]];
    map.on('zoomend', function () {
      if (map.getZoom() > 18) {
        if (!map._imageOverlayAdded) {
          L.imageOverlay('images/ramallah_close.jpg', bounds).addTo(map);
          map._imageOverlayAdded = true;
        }
      }
    });

    // Ø²Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
    document.getElementById('analyzeBtn').addEventListener('click', function () {
      alert("ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: \nØ³ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡Ø§ Ø¹Ù†Ø¯ ØªÙˆÙØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©.\n(ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø¬Ø¯ÙˆÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§)");
    });
  </script>

</body>

</html>











