<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Ramallah Waste Containers</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

<style>
body { margin:0; height:100%; width:100%; }
#map { position:absolute; top:0; bottom:0; width:100%; }

.search-container {
  position: absolute; top: 10px; right: 10px; z-index:1000;
  background: white; padding:5px; border-radius:5px; box-shadow:0 0 5px rgba(0,0,0,0.3);
}
.search-container input { width:200px; padding:4px; }
.north-arrow {
  background: white; padding:5px; border-radius:5px; box-shadow:0 0 5px rgba(0,0,0,0.3);
}
</style>
</head>
<body>
<div id="map"></div>

<div class="search-container">
  <input type="text" id="zoneSearch" placeholder="Search Zone...">
</div>

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
const map = L.map('map', {center:[31.9045,35.2045], zoom:17.5, zoomSnap:0.5});

// Base map
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:20, attribution:'&copy; OpenStreetMap'}).addTo(map);

// Scale
L.control.scale({metric:true, imperial:false}).addTo(map);

// North arrow
L.control({position:'topright'}).onAdd = function(map){
  const div = L.DomUtil.create('div','north-arrow'); div.innerHTML='&#8593; N'; return div;
}.addTo(map);

let zonesLayer = L.layerGroup().addTo(map); // placeholder
let wasteCluster = L.markerClusterGroup().addTo(map);

// Load Zones
$.getJSON("RamallahZones.json", function(RZ){
  zonesLayer.clearLayers();
  L.geoJson(RZ, {
    style: f => ({fillColor:"yellow", fillOpacity:0.3, color:"yellow", weight:1, opacity:0.7}),
    onEachFeature: function(feature, layer){
      layer.on('click', ()=> alert("Zone: " + feature.properties.NAME_ENGLI + "\nMAIL_CODE: " + feature.properties.MAIL_CODE));
    }
  }).addTo(zonesLayer);

  // Search
  $('#zoneSearch').on('input', function(){
    const val = $(this).val().toLowerCase();
    zonesLayer.eachLayer(l => {
      if(l.feature.properties.NAME_ENGLI.toLowerCase().includes(val)){
        map.fitBounds(l.getBounds());
      }
    });
  });
});

// Load Waste Containers
$.getJSON("wasteContainer.json", function(WC){
  const markers = L.geoJson(WC, {
    pointToLayer: (feature, latlng) => L.circleMarker(latlng,{radius:6, fillColor:"orange", color:"orange", weight:1, opacity:1, fillOpacity:0.8}),
    onEachFeature: (feature, layer) => {
      layer.bindPopup("<b>Zone:</b> " + feature.properties.zone + "<br><b>Container Type:</b> " + feature.properties.type);
    }
  });
  wasteCluster.addLayer(markers);
  map.addLayer(wasteCluster);
});

// Layer control
L.control.layers({}, {"Zones":zonesLayer, "Waste Containers":wasteCluster}).addTo(map);
</script>
</body>
</html>
